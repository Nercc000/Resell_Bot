# Caddyfile for IP-based HTTPS (Self-Signed / Internal)

# Global options
{
    # disable auto-https for local testing if needed, but we want it ON for the server
    # auto_https off 
}

# Site block for the IP address
# Caddy will attempt to get a ZeroSSL cert if possible, otherwise falls back to internal self-signed.
45.147.7.54 {
    # Force internal self-signed cert (instantly works, no ACME issues)
    tls internal

    # Reverse proxy to the backend container
    reverse_proxy backend:8000

    # CORS is handled by FastAPI app
    # (removing manual headers to avoid duplicates)
    
    # Optional: Basic Auth for security (since it's public IP!)
    # basicauth / {
    #     admin JDJhJTE0J... 
    # }
}
