# Caddyfile for IP-based HTTPS (Self-Signed / Internal)

# Global options
{
    # disable auto-https for local testing if needed, but we want it ON for the server
    # auto_https off 
}

# Site block for the IP address
# Caddy will attempt to get a ZeroSSL cert if possible, otherwise falls back to internal self-signed.
# Using nip.io allows us to get a REAL Let's Encrypt certificate!
api.resellerbot.de {
    reverse_proxy ps5-bot-backend:8000

    header {
        Access-Control-Allow-Origin "https://resellerbot.de https://www.resellerbot.de http://localhost:3000"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
        Access-Control-Allow-Credentials "true"
    }
    # CORS is handled by FastAPI app
    # (removing manual headers to avoid duplicates)
    
    # Optional: Basic Auth for security (since it's public IP!)
    # basicauth / {
    #     admin JDJhJTE0J... 
    # }
}
